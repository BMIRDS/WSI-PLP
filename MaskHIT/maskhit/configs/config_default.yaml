# Dataset and Model Configuration File
# This configuration file sets parameters for dataset preprocessing and model training.
# Modify values in config_user.yaml to override defaults.

# NOTE: To override any values in this file, please create config_user.yaml 
# (or any YAML file name of you like).
# In config_user.yaml, only define the variables you wish to update. 
# Unmentioned variables will use the default values specified here.
# Please avoid directly modifying values in this file.
#
# Documentation Tags:
#  (default): variables can be left with their default values
#  (custom): more likely to need modification for each user
#---------------------------------------------------

### DATASET CONFIGURATION ###
dataset:
  ## Dataset configuration

  # Path to the file (svs_meta.pickle) containing meta info about svs data
  # File is generated by SlidePrep/MaskHIT_Prep/05_post_process.py
  meta_svs: !!str <SET_YOUR_OWN_VALUE>

  # Path to the file (meta.pickle) containing meta info about the dataset
  # File is generated by SlidePrep/MaskHIT_Prep/01_get_svs_meta.py
  meta_all: !!str <SET_YOUR_OWN_VALUE>

  # Outcome our model is trying to predict
  # Example: "Dx (U=UC, C=Cr, I=Ind)"
  #TODO: Not sure what this is meant. In what format? If this is for classification, clarify.
  outcome: !!str <SET_YOUR_OWN_VALUE>

  # classification type
  # Available options: survival, classification, regression
  outcome_type: !!str classification
  
  # the name of the study
  #TODO: suggest to rename to 'study_name' for clarity.
  study: !!str <SET_YOUR_OWN_VALUE>

  # type of disease; whether it is cancer or not
  #TODO: Add doc to discuss why this is matter. If necessary, we should rename.
  is_cancer: !!bool False

  # title of project/disease name
  #TODO: what's the difference between this and 'study'
  #This seems to be used for folder value:??
  #        `meta_svs['folder'] = config.dataset.disease`
  #Better rename or explain the main intent of this parameter.
  disease: !!str <SET_YOUR_OWN_VALUE>

  # names of classes in your dataset
  #TODO: need doc and example.
  classes: !!str <SET_YOUR_OWN_VALUE>

  # Number of folds for nested cross-validation
  num_folds: !!int 5

patch:
  ## Patch configuration

  # number of patches from each region. If 0 will sample all patches
  num_patches: !!int 0

  # magnification level at which patches were extracted at
  #TODO: Why manually setting this again? Or can we specify a config file from Prep to extract this info?
  magnification: !!int 10

  # intensity of weight decay
  #TODO: Why this is under patch section?
  wd: !!float 0.01

model:
  ## Model configuration

  # used for uneven class distribution
  weighted_loss: !!bool False
  
  # learning rate
  lr: !!float 1e-5

  # Dropout rate
  dropout: !!float 0.2

  # Batch size for processing slide patches
  batch_size: !!int 16

  # which fold to use after kfold cross validation
  #TODO: Not sure what this means. Also suggest to change variable name to be more descriptive.
  fold: !!int 0
  
  # determines whether old logs should stay
  override_logs: !!bool True

  # number of svs sampled in sample-patient mode
  regions_per_svs: !!int 64
  
  #TODO: Copied from config_ibd_train.yaml. Need to double check the default values.
  # Weight Decays
  wd_attn: !!float 1e-3
  wd_fuse: !!float 1e-2 # changed from 1e-3 to 1e-2
  wd_loss: !!float 1e-2 # changed from 1e-3 to 1e-2
  wd_pred: !!float 0.002
  
  #TODO: Copied from config_ibd_train.yaml. Need to double check the default values.
  # Learning Rates
  lr_attn: !!float 1e-5 # lowered since we are using pre-trained model
  lr_fuse: !!float 1e-4
  lr_loss: !!float 1e-4
  lr_pred: !!float 7e-4

  #TODO: Copied from config_ibd_train.yaml. Need to double check the default values.
  #Not sure what this is for, as in the code it chooses a measure based on outcome_type?
  performance_measure: !!str f1

  #TODO: Copied from config_ibd_train.yaml. Add doc.
  accumulation_steps: !!int 1

  #TODO: Copied from config_ibd_train.yaml. Need to double check the default values.
  dropout: !!float 0.2

  #TODO: Copied from config_ibd_train.yaml. Need to double check the default values.
  #TODO: What is this for? and what's # for visualization (64)
  batch_size: !!int 16 # for visualization (64)

  #TODO: Copied from config_ibd_train.yaml. Maybe: overwrite_logs 
  override_logs: !!bool True

  # TBD
  #TODO: Missing docs.
  sample_patient: !!bool True

  # Check-point path?
  #TODO: Missing docs.
  resume: null


